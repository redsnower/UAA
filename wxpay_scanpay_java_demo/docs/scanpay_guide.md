# 微信支付入门到精通

## 第一章：初出茅庐    

有一天，一位拥有N家门店的土豪老板在路上散步路过自家一分店，突然听到一个路人甲刚从他们店出来，嘴里貌似在鄙视他家的分店不支持微信支付让其很不爽，于是土豪老板就凑过去了。
路人甲：“是的，你没有听错，在这个移动互联网时代，如果你的门店连微信支付都不支持的话，你就彻底的OUT了。”  
土豪老板：“我为啥一定要接微信支付啊，不是还有像支付宝等其他移动支付么？”  
路人甲：“<strong>如果我告诉你说，10个人里面，9.5个人有安装微信</strong>，你信么？”  
土豪老板不加思索：“这。。。我信我信！那我也要接入微信支付！”   

土豪老板回到单位，紧急召集会议，说我们要马上接微信支付，让客人来到咱们店里也可以享受非常方便的支付体验。 于是他指定他的得力助手去给办这个事情。  

助手考察了两天回来跟老板说了他考察到的情况。

土豪老板：“什么？接微信支付还需要自己开发程序？”  
助手：“是的老板，微信支付要接入必须得我们自己开发，让我们自己的收银系统跟微信支付打通才行”  
土豪老板：“那么接微信支付的第三方到底哪家强？”  
助手：“老板，目前市面上还没有特别突出的。”  
土豪老板：“我不管，就算找几个懂开发的临时工也要尽快把这个事情给我搞定，搞不定就不用回来见我了！”  
助手：“好的老板，属下立马去办！”    

于是助手赶紧让朋友推荐了几个懂开发的程序员，开始紧锣密鼓地展开这个事情。

## 第二章：被各种奇葩强敌彻底打败

程序员是三两下凑到了，但助手发现这个事情一直进展很不顺利，接二连三地遇到各种强敌，接入事宜停滞不前。  

#### 强敌一：上手复杂  
程序员们压根不知道该如何上手，关摸索就花了很长时间，期间遇到很多问题，例如“签名算法不知道怎么写、XML解析好麻烦、随机数产生算法犯愁、HTTPS请求不知道如何发起”等等。。。

#### 强敌二：API复杂  
程序员发现请求一个API需要构造好多参数，好不容易构造出一批参数提交到API，却发现API有各种返回的错误码，也不知道该如何处理。。。

#### 强敌三：流程复杂  
程序员发现关调用支付的API是不行的，有的时候支付失败了还得马上调用查询API进行查询，查询不成功之后还得再调用撤销API进行撤销。。。简直快要奔溃了。。。  

事情已经过去了一两个月了，还是没搞定，助手想起老板说的那句话，感觉任务完不成也确实没脸再去见他了，打算以死谢罪，于是爬到了一个山崖边，纵身一跃。。。

## 第三章：掉进山崖捡到武林秘籍  

上天总是会为每一个跌下山崖命不该绝的生命配备一本“武林秘籍”作为奖励，而这个助手果然命大，并且还刚好捡到了那本传说中的《微信支付入门到精通》宝典，他流泪满面地翻开了第一页，只见其中就只有这么几个大字：“欲练此功，必先自攻”

“有没有搞错啊。。。”，助手差点撞墙再死一回。定了定神之后才发现哦原来是自己理解错了，是“自攻”而不是“自宫”。顿时松了一口气。   

原来要接入微信支付之前，必须自己先攻读一下准备知识：  
1. <a href="https://github.com/grz/wxpay_scanpay_java_sdk#user-content-%E4%BB%80%E4%B9%88%E6%98%AF%E8%A2%AB%E6%89%AB%E6%94%AF%E4%BB%98" target="_blank">了解什么是“被扫支付”</a>  
2. <a href="https://mp.weixin.qq.com/paymch/readtemplate?t=mp/business/faq_tmpl" target="_blank">商户申请开通“微信支付”的指引</a>

读完以上准备知识之后，可以开始进入练功阶段了：
#### 初级篇：API文档修炼  

API是微信支付后台提供的最基础的最原始的形式，API定义了一个具体的原子功能，例如“支付”API、“查询API”、“撤销API”、“退款API”、“退款查询API”、“下载对账单API”等，每一个API都是一个具体的功能。  
同时API也会定义调用这个API时需要传过去的每一个参数的含义和具体格式，同时还会定义每一个返回参数的含义。

而这一切都在《微信支付API文档》里面做了非常详细的说明。
但是该文档里面内容非常多，在这里建议先详细修炼里面第五章“5.  被扫支付模式开发指引”。

    篇尾语：
        修炼完API文档之后理论上自己已经可以着手进行开发了，
        但是如果能够练到到中级篇的话，将会有事半功倍的疗效。  

助手练完初级篇之后对微信支付API有了比较全面的了解，但感觉意犹未尽，决定深入到终极篇。

#### 中级篇：SDK文档修炼  

在初级篇里面的API文档其实大家可以发现里面定义了很多条件，例如“参数必须以XML的格式post给API”、“API返回的数据格式也是XML”、“数据需要签名”、“需要加随机数”、“需要发HTTPS请求”等。如果条件都是开发者需要自己去折腾的话，那真的有多几条命都不够花，于是SDK的诞生就显得非常有必要了。  

##### 当你学会使用SDK之后，意味着什么？  
1. 意味着XML数据组装和解析不需要自己动手了,SDK帮你搞定；
2. 签名生成、签名验证通通不需要开发者去注意，SDK自动帮忙搞定；
3. 随机数生成算法SDK自动帮你搞定，自动帮你调用，让你几乎完全没有感知到它的存在；
4. HTTPS请求器的封装SDK帮你搞定，你只需要轻松调用即可；  

如何用好微信支付SDK，请详细修炼<a href="https://github.com/grz/wxpay_scanpay_java_sdk" target="_blank">《微信支付SDK说明文档》</a>

    篇尾语：
        完成SDK文档修炼之后可以让你觉得茅塞顿开、身轻如燕。
        因为很多繁琐的底层东西都帮你封装好了，不需要自己操心，省了好多宝贵的时间。
        但是如果想要真正精通微信支付的话，还是建议好好修炼下高级篇。
        你将会学到很多微信支付的最佳实践，这些东西Demo直接会教你如何做。

助手觉得既然自己都练到中级篇了，为何不再练个彻底呢，于是，他又迫不及待地翻开了下一页。

#### 高级篇：Demo文档修炼  

中级篇里面介绍的是如何使用官方提供的SDK帮你省去很多繁琐的算法、数据解析等工作，但是要想更加地省事，当然还得好好修炼Demo文档。 

##### Demo里面帮你搞定了什么？  
1. 完善的经过自测用例测试过的代码，直接拷贝去用，绿色又环保；
2. 经过其他商户帮忙验证过的最佳实践（什么时候该调用查询接口？什么时候该调用撤销接口？），如果懒得自己折腾又想图个保险，请直接拿去用，确保安全可靠、系统稳定；
3. 商户可以把精力聚焦于如何产生“授权码”、“订单号”、“订单描述信息”等跟商户自己息息相关的接口，供SDK使用，微信支付侧的逻辑完全不需要商户过多操心； 

如何用好微信支付Demo，请详细修炼<a href="https://github.com/grz/wxpay_scanpay_java_demo" target="_blank">《微信支付Demo说明文档》</a> 

##### 读完Demo文档之后基本上可以很快完成接入，但还有一些相关知识需要研读，它们是：
1. 《HTTPS服务器配置指南》
2. 《商户系统部署建议》
3. 《商户系统开发设计建议》
4. 《商户接入自测验收手册》
5. 《企业红包使用说明》（有需要用到企业红包的时候再读）

读完以上知识基本就差不多了。

    篇尾语：
        恭喜你完成修炼，可以出山了。
助手练到这里感觉一切关于微信支付的东西全部融会贯通，豁然开朗，原来接入微信支付竟然可以如此简单！  


## 修成正果，出山  

助手立马快马加鞭回到原来现实生活中，利用自己学到的技巧教会了程序员们，果然三两下完成了微信支付的接入，从此以后，所有的客人都能在土豪老板的店里享受到微信支付的便捷。  

后来没过多久，助手从老板那里辞了职，作为微信支付接入高级咨询师的角色，开始混迹于移动互联网O2O的江湖里。

故事终。
  



